{"version":3,"sources":["controllers/chat.controller.ts"],"names":[],"mappings":"AAAA,IAAU,cAAc,CA6GvB;AA7GD,WAAU,cAAc;IAAC,IAAA,IAAI,CA6G5B;IA7GwB,WAAA,IAAI,EAAC,CAAC;QAU3B;YAII,qBAAmB,IAAY,EACpB,IAAY,EACZ,QAAgB,EAChB,SAAiB;gBAHT,SAAI,GAAJ,IAAI,CAAQ;gBACpB,SAAI,GAAJ,IAAI,CAAQ;gBACZ,aAAQ,GAAR,QAAQ,CAAQ;gBAChB,cAAS,GAAT,SAAS,CAAQ;YAC5B,CAAC;YACL,kBAAC;QAAD,CATA,AASC,IAAA;QAsBD;YAWI,wBAAoB,MAAiB,EACjB,YAAyB,EACzB,mBAAwB;gBAFxB,WAAM,GAAN,MAAM,CAAW;gBACjB,iBAAY,GAAZ,YAAY,CAAa;gBACzB,wBAAmB,GAAnB,mBAAmB,CAAK;gBAXrC,YAAO,GAAG,CAAC,QAAQ,EAAE,cAAc,EAAE,qBAAqB,CAAC,CAAC;gBAY/D,IAAI,CAAC,IAAI,EAAE,CAAC;YAChB,CAAC;YAED,6BAAI,GAAJ;gBACI,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;gBACnC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;gBACvC,IAAI,CAAC,OAAO,GAAG,EAAE,CAAC;gBAClB,IAAI,CAAC,YAAY,GAAG,IAAI,KAAK,EAAgB,CAAC;gBAC9C,IAAI,CAAC,OAAO,EAAE,CAAC;YACnB,CAAC;YAEM,gCAAO,GAAd;gBAAA,iBAcC;gBAZG,IAAI,CAAC;oBACD,CAAC,CAAC,UAAU,CAAC,GAAG,CAAC,GAAG,GAAG,gBAAW,CAAC,YAAY,CAAC;oBAChD,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC,UAAU,CAAC,WAAW,CAAC;oBAC5C,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,UAAU,GAAG,UAAC,IAAY,EAAE,OAAe;wBAC/D,KAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,WAAW,CAAC,IAAI,EAAE,OAAO,EAAE,IAAI,IAAI,EAAE,CAAC,YAAY,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;wBACtF,KAAI,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC;wBACrB,KAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;oBAC9B,CAAC,CAAC;gBAEN,CAAE;gBAAA,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;oBACV,OAAO,CAAC,KAAK,CAAC,2DAA2D,CAAC,CAAC;gBAC/E,CAAC;YACL,CAAC;YAEM,6BAAI,GAAX;gBAAA,iBAQC;gBAPG,CAAC,CAAC,UAAU,CAAC,GAAG,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC;oBAC1B,KAAI,CAAC,WAAW,CAAC,MAAM,CAAC,oBAAoB,CAAC,KAAI,CAAC,QAAQ,CAAC,CAAC;oBAC5D,KAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;oBACrB,KAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;gBAC9B,CAAC,CAAC,CAAC,IAAI,CAAC;oBACJ,KAAI,CAAC,WAAW,GAAG,IAAI,CAAC;gBAC5B,CAAC,CAAC,CAAC;YACP,CAAC;YAEM,6BAAI,GAAX;gBACI,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;oBACjC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;oBAC5E,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;oBACvB,IAAI,CAAC,OAAO,GAAG,EAAE,CAAC;gBACtB,CAAC;YACL,CAAC;YAEM,kCAAS,GAAhB,UAAiB,KAAa;gBAC1B,EAAE,CAAC,CAAC,gBAAW,CAAC,gBAAgB,IAAI,aAAQ,CAAC,MAAM,CAAC,CAAC,CAAC;oBAClD,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;gBACzC,CAAC;YACL,CAAC;YACL,qBAAC;QAAD,CAhEA,AAgEC,IAAA;QAhEY,mBAAc,iBAgE1B,CAAA;QAED,OAAO,CAAC,MAAM,CAAC,gBAAgB,CAAC,CAAC,UAAU,CAAC,gBAAgB,EAAE,cAAc,CAAC,CAAC;IAElF,CAAC,EA7GwB,IAAI,GAAJ,mBAAI,KAAJ,mBAAI,QA6G5B;AAAD,CAAC,EA7GS,cAAc,KAAd,cAAc,QA6GvB","file":"controllers/chat.controller.js","sourcesContent":["namespace proafsolutions.chat {\r\n\r\n    interface IChatMessage {\r\n        name: string;\r\n        roomName: string;\r\n        text: string;\r\n        datetime: string;\r\n        avatarUrl: string;\r\n    }\r\n\r\n    class ChatMessage implements IChatMessage {\r\n\r\n        public roomName: string;\r\n\r\n        constructor(public name: string,\r\n            public text: string,\r\n            public datetime: string,\r\n            public avatarUrl: string) {\r\n        }\r\n    }\r\n\r\n    interface IChatParams extends angular.ui.IStateParamsService {\r\n        name: string;\r\n        room: string;\r\n    }\r\n\r\n    interface IChatController {\r\n        isJoined: boolean;\r\n        name: string;\r\n        roomName: string;      \r\n        message: string;\r\n        chatRoomHub: ChatRoomHub;\r\n        conversation: Array<IChatMessage>;\r\n\r\n        //Actions\r\n        join(): void;       \r\n        send(): void;      \r\n        initHub(): void;\r\n\r\n    }\r\n\r\n    export class ChatController implements IChatController {\r\n\r\n        public $inject = ['$scope', '$stateParams', '$cordovaNativeAudio'];\r\n       \r\n        public isJoined: boolean;\r\n        public name: string;\r\n        public roomName: string;      \r\n        public message: string\r\n        public chatRoomHub: ChatRoomHub;\r\n        public conversation: Array<IChatMessage>;\r\n       \r\n        constructor(private $scope: ng.IScope,\r\n                    private $stateParams: IChatParams,\r\n                    private $cordovaNativeAudio: any) {\r\n            this.init();  \r\n        }\r\n\r\n        init(): void {\r\n            this.name = this.$stateParams.name;\r\n            this.roomName = this.$stateParams.room;\r\n            this.message = '';\r\n            this.conversation = new Array<IChatMessage>();\r\n            this.initHub();\r\n        }\r\n\r\n        public initHub(): void {\r\n\r\n            try {\r\n                $.connection.hub.url = AppSettings.API_HUBS_URL;\r\n                this.chatRoomHub = $.connection.chatRoomHub;\r\n                this.chatRoomHub.client.getMessage = (name: string, message: string) => {                   \r\n                    this.conversation.push(new ChatMessage(name, message, new Date().toTimeString(), \"\"));                    \r\n                    this.$scope.$apply();\r\n                    this.playSound('receive');        \r\n                };\r\n\r\n            } catch (ex) {\r\n                console.error(\"Coudn't reach the server , check if the server is running\");\r\n            }\r\n        }\r\n\r\n        public join(): void {           \r\n            $.connection.hub.start().done(() => {         \r\n                this.chatRoomHub.server.joinRoomFromAdminApp(this.roomName);   \r\n                this.isJoined = true; \r\n                this.playSound('welcome');          \r\n            }).fail(() => {\r\n                this.chatRoomHub = null;              \r\n            });\r\n        }\r\n\r\n        public send(): void {\r\n            if (this.isJoined && this.roomName) {\r\n                this.chatRoomHub.server.sendMessage(this.name, this.message, this.roomName);\r\n                this.playSound('send');        \r\n                this.message = '';\r\n            }\r\n        }\r\n\r\n        public playSound(audio: string): void {\r\n            if (AppSettings.CURRENT_RUN_MODE == RUN_MODE.MOBILE) {\r\n                this.$cordovaNativeAudio.play(audio);        \r\n            }\r\n        }       \r\n    }\r\n    \r\n    angular.module(\"proafsolutions\").controller(\"ChatController\", ChatController);\r\n\r\n}"],"sourceRoot":"C:\\Alex\\Git\\ProAFSolutions\\ProAFSolutions.IonicChatClient\\app"}